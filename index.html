<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>×›×™×ª×•×ª ×’×³â€“×“×³ | ××©×—×§×•×Ÿ ×¢×¦×××™: ××™×š ×‘×™× ×” ×™×•×¦×¨×ª ×¢×•×‘×“×ª?</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#121a33;
      --text:#eaf0ff;
      --muted:#b8c4ff;
      --line: rgba(255,255,255,.10);
      --shadow: 0 16px 40px rgba(0,0,0,.35);
      --r:18px;
      --r2:14px;
      --good: rgba(97,255,182,.10);
      --bad: rgba(255,110,138,.10);
      --warn: rgba(255,213,106,.10);
      --font: system-ui, -apple-system, "Segoe UI", "Heebo", "Arial", sans-serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--font);
      background:
        radial-gradient(1100px 600px at 20% 10%, rgba(110,231,255,.12), transparent 60%),
        radial-gradient(900px 500px at 90% 20%, rgba(97,255,182,.10), transparent 65%),
        radial-gradient(900px 500px at 50% 100%, rgba(255,110,138,.10), transparent 55%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:18px;
    }
    .app{width:min(1060px,100%);}
    .topbar{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding:14px 16px;
      background: rgba(255,255,255,.04);
      border:1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
    }
    .brand{display:flex; gap:10px; align-items:center;}
    .logo{
      width:44px; height:44px; border-radius: 14px;
      background: linear-gradient(135deg, rgba(110,231,255,.95), rgba(97,255,182,.85));
      display:grid; place-items:center;
      color:#001018;
      font-weight:900;
      letter-spacing:.4px;
    }
    .title h1{margin:0; font-size:18px;}
    .title p{margin:2px 0 0; font-size:12px; color:var(--muted); line-height:1.4;}
    .stats{display:flex; gap:10px; align-items:center; flex-wrap:wrap; font-size:12px; color:var(--muted);}
    .pill{padding:6px 10px; border-radius:999px; border:1px solid var(--line); background: rgba(255,255,255,.03);}
    .progress{height:10px; width:260px; border-radius:999px; border:1px solid var(--line); background: rgba(255,255,255,.03); overflow:hidden;}
    .progress>div{height:100%; width:0%; background: linear-gradient(90deg, rgba(110,231,255,.9), rgba(97,255,182,.85)); transition: width .35s ease;}

    .grid{margin-top:14px; display:grid; grid-template-columns: 1.2fr .8fr; gap:14px;}
    @media (max-width: 920px){ .grid{grid-template-columns:1fr;} .progress{width:180px;} }

    .card{
      background: rgba(18,26,51,.86);
      border:1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding:16px;
    }
    h2{margin:0 0 8px; font-size:18px;}
    h3{margin:0 0 8px; font-size:15px;}
    .muted{color:var(--muted); font-size:13px; line-height:1.55;}
    .divider{height:1px; background:var(--line); margin:14px 0;}
    .big{font-size:16px; line-height:1.65;}
    .kbd{
      display:inline-block;
      font-size:12px;
      border:1px solid var(--line);
      padding:2px 7px;
      border-radius: 8px;
      background: rgba(255,255,255,.03);
      color: var(--muted);
      vertical-align: middle;
    }
    .choicegrid{display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:10px; margin-top:10px;}
    @media (max-width:560px){ .choicegrid{grid-template-columns:1fr;} }
    .choice{
      text-align:right;
      padding:12px;
      border-radius: var(--r2);
      background: rgba(255,255,255,.03);
      border:1px solid var(--line);
      min-height:56px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      cursor:pointer;
      user-select:none;
    }
    .choice .tag{
      font-size:12px;
      color: var(--muted);
      border:1px solid var(--line);
      padding:4px 8px;
      border-radius:999px;
      background: rgba(255,255,255,.02);
      white-space:nowrap;
    }
    .choice.correct{border-color: rgba(97,255,182,.40); background: var(--good);}
    .choice.wrong{border-color: rgba(255,110,138,.40); background: var(--bad);}

    .toast{
      margin-top:10px;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      font-size:13px;
      line-height:1.55;
    }
    .toast.good{border-color: rgba(97,255,182,.35); background: var(--good);}
    .toast.warn{border-color: rgba(255,213,106,.35); background: var(--warn);}
    .toast.bad{border-color: rgba(255,110,138,.35); background: var(--bad);}

    .btnrow{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;}
    button{
      font-family:var(--font);
      cursor:pointer;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--text);
      padding:10px 12px;
      border-radius: 14px;
      transition: transform .05s ease, background .2s ease, border-color .2s ease;
      text-align:right;
    }
    button:hover{background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.18);}
    button:active{transform: translateY(1px);}
    .primary{
      background: linear-gradient(135deg, rgba(110,231,255,.95), rgba(97,255,182,.85));
      color:#001018;
      border-color: transparent;
      font-weight:700;
    }
    .ghost{opacity:.9}
    .smalllist{padding-right:18px; margin:8px 0 0; color:var(--muted); font-size:13px; line-height:1.7;}

    .stickers{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;}
    .st{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      color: var(--muted);
    }
    .st.on{
      border-color: rgba(97,255,182,.35);
      background: rgba(97,255,182,.10);
      color: var(--text);
    }

    textarea, input[type="text"]{
      width:100%;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--text);
      padding:10px 12px;
      font-family: var(--font);
      font-size:14px;
      outline:none;
    }
    textarea{min-height:90px; resize:vertical;}
    .twoCol{display:grid; grid-template-columns:1fr 1fr; gap:10px;}
    @media (max-width:560px){ .twoCol{grid-template-columns:1fr;} }
    .badge{
      display:inline-block;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-size:12px;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <div class="brand">
        <div class="logo">AI</div>
        <div class="title">
          <h1>××©×—×§×•×Ÿ ×¢×‘×•×“×” ×¢×¦×××™×ª (×›×™×ª×•×ª ×’×³â€“×“×³)</h1>
          <p>×œ×•××“×™× ×‘Ö¾20â€“35 ×“×§×•×ª: ×“×¤×•×¡×™× â†’ × ×™×—×•×© â†’ ××™××•×Ÿ â†’ × ×™×¡×•×— ×‘×§×©×” â†’ ×‘×“×™×§×ª ×××™× ×•×ª + ×¡×™×›×•× ××™×©×™</p>
        </div>
      </div>
      <div class="stats">
        <div class="pill">×›×•×›×‘×™×: <b id="score">0</b> â­</div>
        <div class="pill">××©×™××”: <b id="task">1</b>/<span id="taskTotal">12</span></div>
        <div class="progress" aria-label="progress"><div id="prog"></div></div>
      </div>
    </div>

    <div class="grid">
      <div class="card" id="main"></div>

      <div class="card">
        <h3>×ª×•×‘× ×•×ª (×××© ×§×¦×¨)</h3>
        <div class="muted">
          <ul class="smalllist">
            <li><b>×“×¤×•×¡×™×:</b> ×”×‘×™× ×” ×œ×•××“×ª â€œ××” ×—×•×–×¨ ×”×¨×‘×”â€.</li>
            <li><b>× ×™×—×•×©:</b> ×”×™× ×‘×•×—×¨×ª ××” × ×¨××” ×”×›×™ ××ª××™× ×œ×”××©×š.</li>
            <li><b>××™××•×Ÿ:</b> ××” ×©×”×™× â€œ×§×¨××”â€ ××©×¤×™×¢ ×¢×œ ×”×ª×©×•×‘×”.</li>
            <li><b>× ×™×¡×•×—:</b> ×‘×§×©×” ×‘×¨×•×¨×” ×¢×•×–×¨×ª ×œ×”×¦×œ×™×—.</li>
            <li><b>×××™× ×•×ª:</b> ×œ×¤×¢××™× ×—×™×™×‘×™× ×œ×‘×“×•×§ ××§×•×¨.</li>
          </ul>
        </div>

        <div class="divider"></div>

        <h3>××œ×‘×•× ××“×‘×§×•×ª</h3>
        <div class="muted">××¡×¤×• ××“×‘×§×•×ª ×¢"×™ ×”×¦×œ×—×•×ª ×‘×©×œ×‘×™×.</div>
        <div class="stickers" id="stickers"></div>

        <div class="divider"></div>

        <h3>×›×¤×ª×•×¨×™ ×¢×–×¨×”</h3>
        <div class="btnrow">
          <button class="ghost" id="saveBtn">×©××•×¨/×™ ×”×ª×§×“××•×ª</button>
          <button class="ghost" id="loadBtn">×˜×¢×Ÿ/×™</button>
          <button class="ghost" id="resetBtn">××™×¤×•×¡</button>
        </div>
        <div class="muted" style="margin-top:8px;">
          ×©××™×¨×” × ×©××¨×ª ×‘××—×©×‘ ×”×–×” (×œ× × ×©×œ×— ×œ×©×•× ××§×•×).
        </div>
      </div>
    </div>
  </div>

<script>
/* ---------------------------
   Content: 12 tasks (half-lesson)
----------------------------*/
const STICKERS = [
  {id:"pattern", label:"ğŸ” ××¦××ª×™ ×“×¤×•×¡"},
  {id:"guess",   label:"ğŸ§  × ×™×—×•×© ×—×›×"},
  {id:"train",   label:"ğŸ“š ××™××•×Ÿ"},
  {id:"prompt",  label:"âœï¸ × ×™×¡×•×— ×‘×¨×•×¨"},
  {id:"check",   label:"âœ… ×‘×“×™×§×ª ×××™× ×•×ª"},
  {id:"reflect", label:"ğŸ’¬ ×¡×™×›×•× ××™×©×™"},
];

const TASKS = [
  // 1-2 Patterns (abstract but age-friendly)
  {
    kind:"mcq",
    module:"×“×¤×•×¡×™×",
    sticker:"pattern",
    title:"××©×™××” 1: ×“×¤×•×¡ ×©×œ ×¦×‘×¢×™×",
    q:"×”××©×š/×™ ××ª ×”×“×¤×•×¡:  ğŸ”´  ğŸŸ¦  ğŸ”´  ğŸŸ¦  ğŸ”´  ___",
    options:["ğŸŸ¦","ğŸ”´","ğŸŸ©","â­"],
    correct:"ğŸŸ¦",
    why:"×–×” ×“×¤×•×¡ ×—×•×–×¨: ××“×•×â€“×›×—×•×œâ€“××“×•×â€“×›×—×•×œâ€¦"
  },
  {
    kind:"mcq",
    module:"×“×¤×•×¡×™×",
    sticker:"pattern",
    title:"××©×™××” 2: ×“×¤×•×¡ ×©×œ ××™×œ×™×",
    q:"×”××©×š/×™ ××ª ×”×“×¤×•×¡:  ×©×§×˜, ×¨×•×¢×©, ×©×§×˜, ×¨×•×¢×©, ×©×§×˜, ___",
    options:["×¨×•×¢×©","×©×§×˜","××ª×•×§","×—×"],
    correct:"×¨×•×¢×©",
    why:"×”××™×œ×™× ××ª×—×œ×¤×•×ª: ×©×§×˜â€“×¨×•×¢×©."
  },

  // 3-5 Guessing next (language prediction)
  {
    kind:"mcq",
    module:"× ×™×—×•×©",
    sticker:"guess",
    title:"××©×™××” 3: × ×™×—×•×© ×œ×¤×™ ×”×§×©×¨",
    q:"×”×©×œ×/×™: â€œ×‘×’×Ÿ ×”××©×—×§×™× ×× ×™ ×¢×•×œ×” ×¢×œ ×”___â€",
    options:["× ×“× ×“×”","××§×¨×¨","××¡×¤×¨×™×™×","×¡×‘×•×Ÿ"],
    correct:"× ×“× ×“×”",
    why:"×”×§×©×¨ â€œ×’×Ÿ ×”××©×—×§×™×â€ ××›×•×•×Ÿ ×œ× ×™×—×•×© ×©×œ ××©×”×• ×©× ××¦× ×©×."
  },
  {
    kind:"mcq",
    module:"× ×™×—×•×©",
    sticker:"guess",
    title:"××©×™××” 4: × ×™×—×•×© ×œ×¤×™ ×¤×¢×•×œ×”",
    q:"×”×©×œ×/×™: â€œ×›×“×™ ×œ×¦×™×™×¨ ×× ×™ ×¦×¨×™×š/×” ___â€",
    options:["×¢×™×¤×¨×•×Ÿ","×›×¨×™×ª","×× ×¢×•×œ","×›×¤×™×ª"],
    correct:"×¢×™×¤×¨×•×Ÿ",
    why:"×œ×¦×™×™×¨ â†’ ×¢×™×¤×¨×•×Ÿ/×˜×•×©. ×”×‘×™× ×” × ××©×›×ª ×œ××” ×©× ×¤×•×¥ ×‘×“×•×’×××•×ª."
  },
  {
    kind:"mcq",
    module:"× ×™×—×•×©",
    sticker:"guess",
    title:"××©×™××” 5: ××•×ª×• ××©×¤×˜ â€“ ×©×ª×™ ××¤×©×¨×•×™×•×ª ×¡×‘×™×¨×•×ª",
    q:"×”×©×œ×/×™: â€œ×”×›×œ×‘ ×¨×¥ ××—×¨×™ ×”___â€",
    options:["×›×“×•×¨","××—×©×‘","××–×œ×’","×‘×’×“"],
    correct:"×›×“×•×¨",
    why:"×™×© ×›××” ××¤×©×¨×•×™×•×ª ×¡×‘×™×¨×•×ª, ××‘×œ â€œ×›×œ×‘ ×¨×¥ ××—×¨×™ ×›×“×•×¨â€ ×××•×“ × ×¤×•×¥."
  },

  // 6-7 Training (bias of data) â€“ more abstract idea
  {
    kind:"chooseTrain",
    module:"××™××•×Ÿ",
    sticker:"train",
    title:"××©×™××” 6: ×‘×•×—×¨×™× ××™××•×Ÿ",
    q:"×“××™×™× ×• ×©×”×‘×™× ×” ×§×¨××” ×”××•×Ÿ ×¡×™×¤×•×¨×™× ×¢×œ × ×•×©× ××—×“. ×‘×—×¨×• ×¢×œ ××” ×”×™× ×§×¨××”:",
    trainOptions:[
      {key:"×—×™×•×ª", label:"×—×™×•×ª", hint:"×›×œ×‘, ×—×ª×•×œ, ××¨×™×”â€¦"},
      {key:"×—×œ×œ", label:"×—×œ×œ", hint:"×›×•×›×‘×™×, ×˜×™×œ, ×™×¨×—â€¦"},
      {key:"××’×“×•×ª", label:"××’×“×•×ª", hint:"×§×¡×, ×“×¨×§×•×Ÿ, × ×¡×™×šâ€¦"},
      {key:"×›×œ×œ×™", label:"×›×œ×œ×™", hint:"×§×¦×ª ××”×›×•×œ"}
    ]
  },
  {
    kind:"trainTest",
    module:"××™××•×Ÿ",
    sticker:"train",
    title:"××©×™××” 7: ×¨×•××™× ××™×š ×”××™××•×Ÿ ××©×¤×™×¢",
    q:"×¢×›×©×™×• ×‘×“×™×§×”: ×”×©×œ×™××• â€œ×”×œ×™×œ×” ×¨××™×ª×™ â€¦â€ (××” ×”×‘×™× ×” ×ª×‘×—×¨?)",
    outputs:{
      "×—×™×•×ª":  {text:"×—×ª×•×œ ×§×˜×Ÿ ×‘×—×•×¥", reason:"×›×™ ×”×™× ×¨××ª×” ×”××•×Ÿ ×˜×§×¡×˜×™× ×¢×œ ×—×™×•×ª."},
      "×—×œ×œ":   {text:"×›×•×›×‘ × ×•×¦×¥ ×‘×©××™×™×", reason:"×›×™ × ×•×©××™ ×—×œ×œ ×”×•×¤×™×¢×• ×”×¨×‘×” ×‘××™××•×Ÿ."},
      "××’×“×•×ª": {text:"×“×¨×§×•×Ÿ ××¢×•×¤×£", reason:"×›×™ ×‘××’×“×•×ª ×™×© ×™×¦×•×¨×™× ×§×¡×•××™×."},
      "×›×œ×œ×™":  {text:"××©×”×• ××¢× ×™×™×Ÿ", reason:"×›×™ ×–×” ××™××•×Ÿ ××’×•×•×Ÿ ×•×œ× ×××•×§×“."}
    },
    why:"×”××™××•×Ÿ ××©× ×” ××™×œ×• ×¨×¢×™×•× ×•×ª â€œ×§×•×¤×¦×™×â€ ×¨××©×•×Ÿ."
  },

  // 8-10 Prompting: clarity, constraints, examples
  {
    kind:"comparePrompts",
    module:"× ×™×¡×•×— ×‘×§×©×”",
    sticker:"prompt",
    title:"××©×™××” 8: ×œ××” ×‘×§×©×” ×‘×¨×•×¨×” ×—×©×•×‘×”?",
    left:{title:"×‘×§×©×” ×›×œ×œ×™×ª", text:"×ª×›×ª×•×‘ ×œ×™ ×¡×™×¤×•×¨."},
    right:{title:"×‘×§×©×” ×‘×¨×•×¨×”", text:"×ª×›×ª×•×‘ ×¡×™×¤×•×¨ ×§×¦×¨ (6 ××©×¤×˜×™×) ×¢×œ ×™×œ×“×” ×©××•×¦××ª ××¤×” ×¡×•×“×™×ª. ×©×™×”×™×” ××¦×—×™×§, ×•×‘×¡×•×£ ×”×™× ××—×–×™×¨×” ××ª ×”××¤×”."},
    note:"×›×›×œ ×©×”×‘×§×©×” ×‘×¨×•×¨×” ×™×•×ª×¨ (×›××”? ×¢×œ ××”? ××™×–×” ×¡×’× ×•×Ÿ?) â€” ×”×‘×™× ×” ×™×›×•×œ×” ×œ× ×—×© ×ª×©×•×‘×” ××ª××™××” ×™×•×ª×¨."
  },
  {
    kind:"mcq",
    module:"× ×™×¡×•×— ×‘×§×©×”",
    sticker:"prompt",
    title:"××©×™××” 9: ×‘×•×—×¨×™× ×‘×§×©×” ×˜×•×‘×”",
    q:"××™×–×• ×‘×§×©×” ×ª×¢×–×•×¨ ×œ×‘×™× ×” ×œ×ª×ª ×ª×©×•×‘×” ×˜×•×‘×” ×™×•×ª×¨?",
    options:[
      "×ª×¢×©×” ××©×”×• ××’× ×™×‘",
      "×ª×‘×™× ×œ×™ ×”×›×œ",
      "×ª×Ÿ ×œ×™ 3 ×¨×¢×™×•× ×•×ª ×œ×¤×•×¡×˜×¨ ×¢×œ ×—×‘×¨×•×ª, ×¢× ×›×•×ª×¨×ª ×œ×›×œ ×¨×¢×™×•×Ÿ",
      "×ª×›×ª×•×‘ ××œ× ×“×‘×¨×™×"
    ],
    correct:"×ª×Ÿ ×œ×™ 3 ×¨×¢×™×•× ×•×ª ×œ×¤×•×¡×˜×¨ ×¢×œ ×—×‘×¨×•×ª, ×¢× ×›×•×ª×¨×ª ×œ×›×œ ×¨×¢×™×•×Ÿ",
    why:"×–×• ×‘×§×©×” ×©××¡×‘×™×¨×” ×‘×“×™×•×§ ××” ×¨×•×¦×™× ×•×›××”."
  },
  {
    kind:"buildPrompt",
    module:"× ×™×¡×•×— ×‘×§×©×”",
    sticker:"prompt",
    title:"××©×™××” 10: ××ª× ×‘×•× ×™× ×‘×§×©×” (×¤×¨×•××¤×˜)",
    q:"×‘×—×¨×• × ×•×©×, ×•××– ×›×ª×‘×• ×‘×§×©×” ×‘×¨×•×¨×” ×œ×‘×™× ×”:",
    fields:[
      {id:"topic", label:"× ×•×©× (×œ××©×œ: ×—×‘×¨×•×ª / ×˜×‘×¢ / ×—×œ×œ / ×¡×¤×•×¨×˜)", type:"text", placeholder:"×”×§×œ×“/×™ × ×•×©×â€¦"},
      {id:"count", label:"×›××” ×“×‘×¨×™× ××ª/×” ×¨×•×¦×”? (×œ××©×œ 3 ×¨×¢×™×•× ×•×ª / 5 ××©×¤×˜×™×)", type:"text", placeholder:"×”×§×œ×“/×™ ×›××•×ªâ€¦"},
      {id:"style", label:"×¡×’× ×•×Ÿ (××¦×—×™×§ / ×¨×¦×™× ×™ / ×§×¦×¨ / ×¢× ×©××œ×•×ª)", type:"text", placeholder:"×”×§×œ×“/×™ ×¡×’× ×•×Ÿâ€¦"},
      {id:"details", label:"×¤×¨×˜×™× ×—×©×•×‘×™× (××” ×—×™×™×‘ ×œ×”×•×¤×™×¢?)", type:"text", placeholder:"×”×§×œ×“/×™ ×¤×¨×˜/×™×â€¦"}
    ],
    checkHint:"×‘×“×™×§×”: ×”×× ×›×ª×‘×ª ××”, ×›××”, ×¢×œ ××”, ×•××™×–×” ×¡×’× ×•×Ÿ?"
  },

  // 11 Reliability
  {
    kind:"mcq",
    module:"×××™× ×•×ª",
    sticker:"check",
    title:"××©×™××” 11: ××ª×™ ×œ× ×× ×—×©×™×?",
    q:"×©××œ×”: ×›××” ×™×œ×“×™× ×™×© ×¢×›×©×™×• ×‘×›×™×ª×” ×©×œ×š (×‘×¨×’×¢ ×–×”)?",
    options:["25","30","×¦×¨×™×š ×œ×‘×“×•×§ â€“ ×”×‘×™× ×” ×œ× ×™×•×“×¢×ª"],
    correct:"×¦×¨×™×š ×œ×‘×“×•×§ â€“ ×”×‘×™× ×” ×œ× ×™×•×“×¢×ª",
    why:"×›×©×”××™×“×¢ ×œ× × ××¦× ××¦×œ ×”×‘×™× ×” ×•×‘×˜×— ×œ× ×‘×–××Ÿ ×××ª â€” ×œ× ×× ×—×©×™×."
  },

  // 12 Reflection (insights)
  {
    kind:"reflection",
    module:"×¡×™×›×•×",
    sticker:"reflect",
    title:"××©×™××” 12: ×¡×™×›×•× ××™×©×™",
    q:"×›×ª×‘×• 2â€“3 ××©×¤×˜×™×:",
    prompts:[
      "×“×‘×¨ ××—×“ ×©×œ××“×ª×™ ×¢×œ ×‘×™× ×” (×“×¤×•×¡×™×/× ×™×—×•×©/××™××•×Ÿ)â€¦",
      "×“×•×’××” ×œ×‘×§×©×” ×‘×¨×•×¨×” ×©×× ×™ ×™×›×•×œ/×” ×œ×›×ª×•×‘â€¦",
      "××ª×™ ×¦×¨×™×š ×œ×‘×“×•×§ ××§×•×¨ ×•×œ× ×œ×”×¡×ª××š ×¢×œ ×¦×³××˜?"
    ]
  }
];

/* ---------------------------
   State + persistence
----------------------------*/
const STORAGE_KEY = "ai_kids_gd_v1";

let state = {
  i: 0,               // task index
  stars: 0,
  earned: {},         // stickerId -> true
  train: "×›×œ×œ×™",
  answers: {},        // taskIndex -> data (for reflection / prompt)
};

document.getElementById("taskTotal").textContent = TASKS.length;

function clamp(n,min,max){return Math.max(min, Math.min(max,n));}
function esc(s){
  return String(s)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
function updateTop(){
  document.getElementById("score").textContent = state.stars;
  document.getElementById("task").textContent = (state.i + 1);
  const pct = (state.i / (TASKS.length)) * 100;
  document.getElementById("prog").style.width = clamp(pct,0,100) + "%";
  renderStickers();
}
function addStars(n){ state.stars += n; updateTop(); }
function earnSticker(id){
  if(!id) return;
  if(!state.earned[id]){
    state.earned[id] = true;
    addStars(3); // bonus
  }
}
function renderStickers(){
  const box = document.getElementById("stickers");
  box.innerHTML = "";
  STICKERS.forEach(s=>{
    const pill = document.createElement("div");
    pill.className = "st" + (state.earned[s.id] ? " on" : "");
    pill.textContent = s.label;
    box.appendChild(pill);
  });
}
function save(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}
function load(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) return false;
  try{
    const obj = JSON.parse(raw);
    if(!obj || typeof obj !== "object") return false;
    state = obj;
    return true;
  }catch(e){
    return false;
  }
}
function reset(){
  state = { i:0, stars:0, earned:{}, train:"×›×œ×œ×™", answers:{} };
  save();
  updateTop();
  render();
}

/* ---------------------------
   Render tasks
----------------------------*/
const main = document.getElementById("main");

function header(t){
  const wrap = document.createElement("div");
  const h2 = document.createElement("h2");
  h2.textContent = t.title || "";
  const meta = document.createElement("div");
  meta.className = "muted";
  meta.innerHTML = `× ×•×©×: <span class="badge">${esc(t.module)}</span>`;
  wrap.appendChild(h2);
  wrap.appendChild(meta);
  return wrap;
}

function toast(kind, html){
  const t=document.createElement("div");
  t.className="toast "+kind;
  t.innerHTML=html;
  return t;
}

function nextBtn(label="×”××©×š"){
  const row = document.createElement("div");
  row.className="btnrow";
  const b = document.createElement("button");
  b.className="primary";
  b.textContent = label;
  b.onclick = ()=>{
    state.i += 1;
    if(state.i >= TASKS.length){
      renderFinish();
    }else{
      save();
      updateTop();
      render();
    }
  };
  row.appendChild(b);
  return row;
}

function backBtn(){
  const b = document.createElement("button");
  b.textContent = "×—×–×¨×”";
  b.onclick = ()=>{
    state.i = Math.max(0, state.i-1);
    save(); updateTop(); render();
  };
  return b;
}

function render(){
  const t = TASKS[state.i];
  main.innerHTML = "";
  main.appendChild(header(t));

  if(t.kind === "mcq") renderMCQ(t);
  else if(t.kind === "chooseTrain") renderChooseTrain(t);
  else if(t.kind === "trainTest") renderTrainTest(t);
  else if(t.kind === "comparePrompts") renderComparePrompts(t);
  else if(t.kind === "buildPrompt") renderBuildPrompt(t);
  else if(t.kind === "reflection") renderReflection(t);
  else {
    main.appendChild(toast("bad","××©×™××” ×œ× ××•×›×¨×ª."));
  }

  const controls = document.createElement("div");
  controls.className = "btnrow";
  if(state.i > 0) controls.appendChild(backBtn());
  const skip = document.createElement("button");
  skip.textContent = "×“×œ×’/×™";
  skip.onclick = ()=>{ state.i += 1; save(); updateTop(); render(); };
  controls.appendChild(skip);
  main.appendChild(controls);
}

function lockChoices(grid){
  [...grid.querySelectorAll(".choice")].forEach(el=>{ el.style.pointerEvents="none"; el.style.opacity=".95"; });
}

function renderMCQ(t){
  const q = document.createElement("div");
  q.className = "big";
  q.innerHTML = `×©××œ×”: <span class="kbd">${esc(t.q)}</span>`;
  main.appendChild(q);

  const grid = document.createElement("div");
  grid.className = "choicegrid";

  t.options.forEach(opt=>{
    const c = document.createElement("div");
    c.className = "choice";
    c.innerHTML = `<span><b>${esc(opt)}</b></span><span class="tag">×‘×—×™×¨×”</span>`;
    c.onclick = ()=>{
      lockChoices(grid);
      const ok = (opt === t.correct);
      c.classList.add(ok ? "correct" : "wrong");
      if(ok){
        addStars(6);
        earnSticker(t.sticker);
        main.appendChild(toast("good", `<b>× ×›×•×Ÿ!</b> ${esc(t.why)}<br/>+6 â­`));
      }else{
        main.appendChild(toast("bad", `<b>×›××¢×˜.</b> ×”×ª×©×•×‘×” ×”××ª××™××”: <b>${esc(t.correct)}</b><br/><span class="muted">${esc(t.why)}</span>`));
      }
      state.answers[state.i] = {answer: opt, correct: ok};
      save();
      main.appendChild(nextBtn("×œ××©×™××” ×”×‘××”"));
    };
    grid.appendChild(c);
  });
  main.appendChild(grid);
}

function renderChooseTrain(t){
  const q = document.createElement("div");
  q.className = "big";
  q.textContent = t.q;
  main.appendChild(q);

  const grid = document.createElement("div");
  grid.className = "choicegrid";

  t.trainOptions.forEach(opt=>{
    const c = document.createElement("div");
    c.className = "choice";
    c.innerHTML = `<span><b>${esc(opt.label)}</b><div class="muted" style="font-size:12px;margin-top:3px;">${esc(opt.hint)}</div></span><span class="tag">××™××•×Ÿ</span>`;
    c.onclick = ()=>{
      lockChoices(grid);
      state.train = opt.key;
      addStars(5);
      earnSticker(t.sticker);
      state.answers[state.i] = {train: opt.key};
      save();
      c.classList.add("correct");
      main.appendChild(toast("good", `<b>× ×‘×—×¨ ××™××•×Ÿ:</b> ${esc(opt.label)}<br/>×¢×›×©×™×• × ×¨××” ××™×š ×–×” ××©×¤×™×¢. +5 â­`));
      main.appendChild(nextBtn("×œ×‘×“×™×§×”"));
    };
    grid.appendChild(c);
  });
  main.appendChild(grid);
  main.appendChild(toast("warn", "<b>×¨×¢×™×•×Ÿ ×—×©×•×‘:</b> ××™××•×Ÿ = ×”×¨×‘×” ×“×•×’×××•×ª. ××” ×©×¨×•××™× ×”×¨×‘×” â€” ××©×¤×™×¢ ×¢×œ ×”× ×™×—×•×©×™×."));
}

function renderTrainTest(t){
  const q = document.createElement("div");
  q.className = "big";
  q.innerHTML = `×‘×“×™×§×”: <span class="kbd">${esc(t.q)}</span>`;
  main.appendChild(q);

  const out = t.outputs[state.train] || t.outputs["×›×œ×œ×™"];
  const box = document.createElement("div");
  box.className = "toast warn";
  box.innerHTML = `
    ×”×‘×™× ×” (××—×¨×™ ××™××•×Ÿ ×¢×œ <b>${esc(state.train)}</b>) ×›× ×¨××” ×ª×›×ª×•×‘: <span class="kbd">${esc(out.text)}</span><br/>
    <span class="muted">${esc(out.reason)}</span>
  `;
  main.appendChild(box);

  main.appendChild(toast("warn", `<b>×ª×•×‘× ×”:</b> ${esc(t.why)}`));

  const row = document.createElement("div");
  row.className = "btnrow";
  const change = document.createElement("button");
  change.textContent = "×œ×©× ×•×ª ××™××•×Ÿ";
  change.onclick = ()=>{
    // go back to chooseTrain task (previous)
    state.i = Math.max(0, state.i-1);
    save(); updateTop(); render();
  };
  row.appendChild(change);
  row.appendChild(nextBtn("×œ× ×™×¡×•×— ×‘×§×©×”"));
  main.appendChild(row);
}

function renderComparePrompts(t){
  const p = document.createElement("div");
  p.className = "big";
  p.textContent = "×§×¨×/×™ ×©×ª×™ ×‘×§×©×•×ª. ××™×–×• ×ª×™×ª×Ÿ ×ª×•×¦××” ×˜×•×‘×” ×™×•×ª×¨?";
  main.appendChild(p);

  const cols = document.createElement("div");
  cols.className = "twoCol";

  const a = document.createElement("div");
  a.className = "toast bad";
  a.innerHTML = `<b>${esc(t.left.title)}:</b><br/><span class="kbd">${esc(t.left.text)}</span>`;
  const b = document.createElement("div");
  b.className = "toast good";
  b.innerHTML = `<b>${esc(t.right.title)}:</b><br/><span class="kbd">${esc(t.right.text)}</span>`;
  cols.appendChild(a); cols.appendChild(b);
  main.appendChild(cols);

  main.appendChild(toast("warn", esc(t.note)));

  const grid = document.createElement("div");
  grid.className = "choicegrid";

  const opt1 = "×”×‘×§×©×” ×”×›×œ×œ×™×ª";
  const opt2 = "×”×‘×§×©×” ×”×‘×¨×•×¨×”";

  [opt1,opt2].forEach(opt=>{
    const c = document.createElement("div");
    c.className = "choice";
    c.innerHTML = `<span><b>${esc(opt)}</b></span><span class="tag">×‘×—×™×¨×”</span>`;
    c.onclick = ()=>{
      lockChoices(grid);
      const ok = (opt === opt2);
      c.classList.add(ok ? "correct" : "wrong");
      if(ok){
        addStars(6);
        earnSticker(t.sticker);
        main.appendChild(toast("good", "<b>× ×›×•×Ÿ!</b> ×‘×§×©×” ×‘×¨×•×¨×” ×¢×•×–×¨×ª ×œ×‘×™× ×” ×œ× ×—×© ×˜×•×‘ ×™×•×ª×¨. +6 â­"));
      }else{
        main.appendChild(toast("bad", "<b>×›××¢×˜.</b> ×‘×§×©×” ×‘×¨×•×¨×” ×‘×“×¨×š ×›×œ×œ ×ª×™×ª×Ÿ ×ª×•×¦××” ×˜×•×‘×” ×™×•×ª×¨."));
      }
      state.answers[state.i] = {choice: opt, correct: ok};
      save();
      main.appendChild(nextBtn("×œ×”××©×š"));
    };
    grid.appendChild(c);
  });
  main.appendChild(grid);
}

function renderBuildPrompt(t){
  const p = document.createElement("div");
  p.className = "big";
  p.textContent = t.q;
  main.appendChild(p);

  const form = document.createElement("div");
  form.className = "divider";

  const container = document.createElement("div");
  container.className = "twoCol";

  const values = state.answers[state.i]?.values || {};

  t.fields.forEach(f=>{
    const block = document.createElement("div");
    const label = document.createElement("div");
    label.className = "muted";
    label.style.marginBottom = "6px";
    label.textContent = f.label;

    const input = document.createElement("input");
    input.type = "text";
    input.placeholder = f.placeholder || "";
    input.value = values[f.id] || "";
    input.oninput = ()=>{
      values[f.id] = input.value;
      state.answers[state.i] = {values};
      save();
    };

    block.appendChild(label);
    block.appendChild(input);
    container.appendChild(block);
  });

  main.appendChild(container);

  const preview = document.createElement("div");
  preview.className = "toast warn";
  preview.style.marginTop = "12px";
  preview.innerHTML = "<b>×ª×¦×•×’×” ××§×“×™××” ×©×œ ×”×‘×§×©×” ×©×œ×š:</b><div id='previewText' class='muted' style='margin-top:6px;'></div>";
  main.appendChild(preview);

  function updatePreview(){
    const topic = (values.topic || "").trim();
    const count = (values.count || "").trim();
    const style = (values.style || "").trim();
    const details = (values.details || "").trim();

    const parts = [];
    if(topic) parts.push(`×¢×œ × ×•×©×: ${esc(topic)}`);
    if(count) parts.push(`×›××•×ª: ${esc(count)}`);
    if(style) parts.push(`×¡×’× ×•×Ÿ: ${esc(style)}`);
    if(details) parts.push(`×—×™×™×‘ ×œ×›×œ×•×œ: ${esc(details)}`);

    const text = parts.length ? ("×ª×Ÿ/×™ ×œ×™ " + parts.join(" Â· ")) : "×”×ª×—×œ/×™ ×œ××œ× ×›×“×™ ×œ×¨××•×ª ×ª×¦×•×’×” ××§×“×™××”â€¦";
    document.getElementById("previewText").innerHTML = `<span class="kbd">${text}</span>`;
  }
  updatePreview();

  // update preview on every save (simple timer)
  const timer = setInterval(updatePreview, 300);

  const check = document.createElement("button");
  check.className = "primary";
  check.textContent = "×‘×“×™×§×”: ×”×‘×§×©×” ×©×œ×™ ×‘×¨×•×¨×”?";
  check.onclick = ()=>{
    const topic = (values.topic || "").trim();
    const count = (values.count || "").trim();
    const style = (values.style || "").trim();
    const details = (values.details || "").trim();
    const ok = !!(topic && count && style);

    if(ok){
      addStars(8);
      earnSticker(t.sticker);
      main.appendChild(toast("good", `<b>×™×¤×”!</b> ×”×‘×§×©×” ×‘×¨×•×¨×”: ×™×© × ×•×©× + ×›××•×ª + ×¡×’× ×•×Ÿ. <br/>+8 â­`));
    }else{
      main.appendChild(toast("bad", `<b>×¢×•×“ ×§×¦×ª.</b> × ×¡×• ×œ××œ× ×œ×¤×—×•×ª: × ×•×©× + ×›××” ×“×‘×¨×™× + ×¡×’× ×•×Ÿ.<br/><span class="muted">${esc(t.checkHint)}</span>`));
    }
    clearInterval(timer);
    main.appendChild(nextBtn("×œ×”××©×š"));
  };
  main.appendChild(check);

  main.appendChild(toast("warn", "<b>×˜×™×¤:</b> ××¤×©×¨ ×œ×›×ª×•×‘ ×’× â€œ×ª×Ÿ/×™ ×œ×™ 3 ××¤×©×¨×•×™×•×ªâ€ ××• â€œ×›×ª×•×‘/×™ 5 ××©×¤×˜×™×â€ â€” ×–×” ×¢×•×–×¨ ×××•×“."));
}

function renderReflection(t){
  const p = document.createElement("div");
  p.className = "big";
  p.textContent = t.q;
  main.appendChild(p);

  const saved = state.answers[state.i]?.text || "";

  const hints = document.createElement("div");
  hints.className = "toast warn";
  hints.innerHTML = `<b>×¢×–×¨×”:</b><ul class="smalllist">${t.prompts.map(x=>`<li>${esc(x)}</li>`).join("")}</ul>`;
  main.appendChild(hints);

  const ta = document.createElement("textarea");
  ta.placeholder = "×›×ª×•×‘/×™ ×›××Ÿâ€¦";
  ta.value = saved;
  ta.oninput = ()=>{
    state.answers[state.i] = {text: ta.value};
    save();
  };
  main.appendChild(ta);

  const done = document.createElement("button");
  done.className = "primary";
  done.textContent = "×¡×™×™××ª×™ ××ª ×”×¡×™×›×•×";
  done.onclick = ()=>{
    if((ta.value || "").trim().length >= 15){
      addStars(10);
      earnSticker(t.sticker);
      main.appendChild(toast("good", "<b>×›×œ ×”×›×‘×•×“!</b> ×”×©×œ××ª ×¡×™×›×•× ××™×©×™. +10 â­"));
    }else{
      main.appendChild(toast("warn", "<b>×›××¢×˜.</b> × ×¡×• ×œ×”×•×¡×™×£ ×¢×•×“ ××©×¤×˜ ××—×“ (×œ×¤×—×•×ª 15 ×ª×•×•×™×)."));
      return;
    }
    save();
    main.appendChild(nextBtn("×œ×¡×™×•×"));
  };
  main.appendChild(done);
}

/* ---------------------------
   Finish
----------------------------*/
function renderFinish(){
  main.innerHTML = "";
  const doneCount = Object.keys(state.earned).length;
  const all = doneCount === STICKERS.length;

  const h = document.createElement("h2");
  h.textContent = "×¡×™×•×! ğŸ‘";
  main.appendChild(h);

  main.appendChild(toast(all ? "good" : "warn",
    `<b>×ª×•×¦××”:</b> ${state.stars} â­<br/>
     <span class="muted">××“×‘×§×•×ª: ${doneCount}/${STICKERS.length} ${all ? "â€” ××¡×¤×ª ××ª ×›×•×œ×Ÿ!" : ""}</span>`
  ));

  const recap = document.createElement("div");
  recap.className = "toast warn";
  recap.innerHTML = `<b>××” ×—×©×•×‘ ×œ×–×›×•×¨:</b>
    <ul class="smalllist">
      <li>×”×‘×™× ×” ×œ×•××“×ª <b>×“×¤×•×¡×™×</b> ××”××•×Ÿ ×“×•×’×××•×ª.</li>
      <li>×”×™× <b>×× ×—×©×ª</b> ××” ××ª××™× ×œ×”××©×š.</li>
      <li>×”××™××•×Ÿ (××” ×”×™× ×¨××ª×”) ××©×¤×™×¢ ×¢×œ ×”×ª×©×•×‘×•×ª.</li>
      <li>×‘×§×©×” ×‘×¨×•×¨×” = ×ª×•×¦××” ×˜×•×‘×” ×™×•×ª×¨.</li>
      <li>×›×©×¦×¨×™×š ×¢×•×‘×“×” ××“×•×™×§×ª/×¢×›×©×•×•×™×ª â€” <b>×‘×•×“×§×™× ××§×•×¨</b>.</li>
    </ul>`;
  main.appendChild(recap);

  const exportBox = document.createElement("div");
  exportBox.className = "toast";
  exportBox.innerHTML = `<b>×“×•×— ×§×¦×¨ ×œ×”×¢×ª×§×” (××•×¤×¦×™×•× ×œ×™):</b><div class="muted" style="margin-top:6px;">××¤×©×¨ ×œ×”×¢×ª×™×§ ×•×œ×”×“×‘×™×§ ×œ××—×‘×¨×ª/×§×œ××¡×¨×•×.</div>`;
  const out = document.createElement("textarea");
  out.value = buildReportText();
  exportBox.appendChild(out);

  const row = document.createElement("div");
  row.className = "btnrow";

  const copy = document.createElement("button");
  copy.className = "primary";
  copy.textContent = "×”×¢×ª×§ ×“×•×—";
  copy.onclick = async ()=>{
    try{
      await navigator.clipboard.writeText(out.value);
      exportBox.appendChild(toast("good","×”×•×¢×ª×§!"));
    }catch(e){
      exportBox.appendChild(toast("warn","×œ× ×”×¦×œ×—×ª×™ ×œ×”×¢×ª×™×§ ××•×˜×•××˜×™×ª. ××¤×©×¨ ×œ×¡××Ÿ ×•×œ×”×¢×ª×™×§ ×™×“× ×™×ª."));
    }
  };

  const again = document.createElement("button");
  again.textContent = "×©×—×§/×™ ×©×•×‘";
  again.onclick = reset;

  row.appendChild(copy);
  row.appendChild(again);
  exportBox.appendChild(row);

  main.appendChild(exportBox);

  document.getElementById("prog").style.width = "100%";
  document.getElementById("task").textContent = TASKS.length;
  save();
}

function buildReportText(){
  const lines = [];
  lines.push("×“×•×— ××©×—×§×•×Ÿ: ××™×š ×‘×™× ×” ×¢×•×‘×“×ª (×›×™×ª×•×ª ×’×³â€“×“×³)");
  lines.push("×›×•×›×‘×™×: " + state.stars);
  lines.push("××™××•×Ÿ ×©× ×‘×—×¨: " + state.train);
  lines.push("××“×‘×§×•×ª: " + Object.keys(state.earned).join(", "));
  lines.push("");
  // include prompt (task 10) and reflection (task 12) if exists
  const promptTaskIndex = TASKS.findIndex(t=>t.kind==="buildPrompt");
  if(promptTaskIndex >= 0){
    const v = state.answers[promptTaskIndex]?.values || {};
    const parts = [];
    if(v.topic) parts.push("× ×•×©×: " + v.topic);
    if(v.count) parts.push("×›××•×ª: " + v.count);
    if(v.style) parts.push("×¡×’× ×•×Ÿ: " + v.style);
    if(v.details) parts.push("×¤×¨×˜×™×: " + v.details);
    if(parts.length){
      lines.push("×”×‘×§×©×” ×©×‘× ×™×ª×™:");
      lines.push("- " + parts.join(" | "));
      lines.push("");
    }
  }
  const reflIndex = TASKS.findIndex(t=>t.kind==="reflection");
  if(reflIndex >= 0){
    const text = (state.answers[reflIndex]?.text || "").trim();
    if(text){
      lines.push("×¡×™×›×•× ××™×©×™:");
      lines.push(text);
    }
  }
  return lines.join("\n");
}

/* ---------------------------
   Buttons
----------------------------*/
document.getElementById("saveBtn").onclick = ()=>{ save(); alert("× ×©××¨."); };
document.getElementById("loadBtn").onclick = ()=>{
  const ok = load();
  if(ok){ updateTop(); render(); alert("× ×˜×¢×Ÿ."); }
  else alert("××™×Ÿ ×©××™×¨×” ×§×•×“××ª ×‘××—×©×‘ ×”×–×”.");
};
document.getElementById("resetBtn").onclick = ()=>{
  if(confirm("×œ××¤×¡ ××ª ×”××©×—×§×•×Ÿ?")) reset();
};

/* init */
load(); // try auto-load if exists
updateTop();
render();
</script>
</body>
</html>
